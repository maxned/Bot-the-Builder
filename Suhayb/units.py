# Vertual Environment Setup
# cd to file dir
# python3 -m venv $(pwd)
# source $(pwd)/bin/activate

# pip install tqdm
# pip install sc2reader

# To run:
# python3 units.py file1.SC2Replay file2.SC2Replay ...

# Input: paths to star craft 2 replay files
# Output file Structure:
#    units
#      replay.csv
#      ...

import sc2reader, csv, sys, os
from tqdm import trange
from collections import defaultdict

#inital setup
os.makedirs('output/units', exist_ok=True)

files = sys.argv[1:]

#progress bar
pbar = trange(
    len(files),
    desc='Processing',
    bar_format=' {desc}: {bar}  {percentage:3.0f}% ')

#parser
for num, parseFile in enumerate(files, start=1):
    replay = sc2reader.load_replay(parseFile, load_map=1)

    #one vs one
    if len(replay.players) != 2 or replay.type != '1v1' or not replay.competitive:
        raise Exception('Players not equal to two!')

    #Collect Stats of Game
    fps = replay.game_fps
    map_hash = replay.map_hash
    winner = replay.winner.players[0].pid
    loser = 1 + (winner) % 2

    #create output files
    fileName = os.path.splitext(os.path.basename(parseFile))[0]

    # TODO: Check if file already exsists if so skip
    statsFile = open(
        'output/units/' + fileName + '.csv', 'w', newline='')
    statsCSV = csv.writer(statsFile)

    # https://github.com/GraylinKim/sc2reader/blob/d69feb4e0be597581040588193579d29e8241431/sc2reader/data/unit_lookup.csv
    statsHead = [
        'winner', 'seconds',"System_Snapshot_Dummy","BeaconRally","BeaconAttack","BeaconDefend","BeaconHarass","BeaconIdle","BeaconAuto","BeaconDetect","BeaconScout","BeaconClaim","BeaconExpand","BeaconCustom1","BeaconCustom2","BeaconCustom3","BeaconCustom4","DESTRUCTIBLE","ITEM","POWERUP","SMCAMERA","SMCHARACTER","STARMAP","SMSET","MISSILE","MISSILE_INVULNERABLE","MISSILE_HALFLIFE","PLACEHOLDER","PLACEHOLDER_AIR","PATHINGBLOCKER","BEACON","Ball","StereoscopicOptionsUnit","Colossus","TechLab","Reactor","InfestorTerran","BanelingCocoon","Baneling","Mothership","PointDefenseDrone","Changeling","ChangelingZealot","ChangelingMarineShield","ChangelingMarine","ChangelingZerglingWings","ChangelingZergling","CommandCenter","SupplyDepot","Refinery","Barracks","EngineeringBay","MissileTurret","Bunker","SensorTower","GhostAcademy","Factory","Starport","Armory","FusionCore","AutoTurret","SiegeTankSieged","SiegeTank","VikingFighter","VikingAssault","CommandCenterFlying","BarracksTechLab","BarracksReactor","FactoryTechLab","FactoryReactor","StarportTechLab","StarportReactor","FactoryFlying","StarportFlying","SCV","BarracksFlying","SupplyDepotLowered","Marine","Reaper","Ghost","Marauder","Thor","Hellion","Medivac","Banshee","Raven","Battlecruiser","Nuke","Nexus","Pylon","Assimilator","Gateway","Forge","FleetBeacon","TwilightCouncil","PhotonCannon","Stargate","TemplarArchive","DarkShrine","RoboticsBay","RoboticsFacility","CyberneticsCore","Zealot","Stalker","HighTemplar","DarkTemplar","Sentry","Phoenix","Carrier","VoidRay","WarpPrism","Observer","Immortal","Probe","Interceptor","Hatchery","CreepTumor","Extractor","SpawningPool","EvolutionChamber","HydraliskDen","Spire","UltraliskCavern","InfestationPit","NydusNetwork","BanelingNest","RoachWarren","SpineCrawler","SporeCrawler","Lair","Hive","GreaterSpire","Egg","Drone","Zergling","Overlord","Hydralisk","Mutalisk","Ultralisk","Roach","Infestor","Corruptor","BroodLordCocoon","BroodLord","BanelingBurrowed","DroneBurrowed","HydraliskBurrowed","RoachBurrowed","ZerglingBurrowed","InfestorTerranBurrowed","RedstoneLavaCritterBurrowed","RedstoneLavaCritterInjuredBurrowed","RedstoneLavaCritter","RedstoneLavaCritterInjured","QueenBurrowed","Queen","InfestorBurrowed","OverlordCocoon","Overseer","PlanetaryFortress","UltraliskBurrowed","OrbitalCommand","WarpGate","OrbitalCommandFlying","ForceField","WarpPrismPhasing","CreepTumorBurrowed","CreepTumorQueen","SpineCrawlerUprooted","SporeCrawlerUprooted","Archon","NydusCanal","BroodlingEscort","RichMineralField","XelNagaTower","InfestedTerransEgg","Larva","ReaperPlaceholder","NeedleSpinesWeapon","CorruptionWeapon","InfestedTerransWeapon","NeuralParasiteWeapon","PointDefenseDroneReleaseWeapon","HunterSeekerWeapon","MULE","ThorAAWeapon","PunisherGrenadesLMWeapon","VikingFighterWeapon","ATALaserBatteryLMWeapon","ATSLaserBatteryLMWeapon","LongboltMissileWeapon","D8ChargeWeapon","YamatoWeapon","IonCannonsWeapon","AcidSalivaWeapon","SpineCrawlerWeapon","SporeCrawlerWeapon","GlaiveWurmWeapon","GlaiveWurmM2Weapon","GlaiveWurmM3Weapon","StalkerWeapon","EMP2Weapon","BacklashRocketsLMWeapon","PhotonCannonWeapon","ParasiteSporeWeapon","Broodling","BroodLordBWeapon","AutoTurretReleaseWeapon","LarvaReleaseMissile","AcidSpinesWeapon","FrenzyWeapon","ContaminateWeapon","BroodlingDefault","Critter","CritterStationary","Shape","FungalGrowthMissile","NeuralParasiteTentacleMissile","Beacon_Protoss","Beacon_ProtossSmall","Beacon_Terran","Beacon_TerranSmall","Beacon_Zerg","Beacon_ZergSmall","Lyote","CarrionBird","KarakMale","KarakFemale","UrsadakMale","UrsadakFemale","UrsadakCalf","UrsadakMaleExotic","UrsadakFemaleExotic","UtilityBot","CommentatorBot1","CommentatorBot2","CommentatorBot3","CommentatorBot4","Scantipede","Dog","Sheep","Cow","InfestedTerransEggPlacement","InfestorTerransWeapon","MineralField","VespeneGeyser","SpacePlatformGeyser","RichVespeneGeyser","DestructibleSearchlight","DestructibleBullhornLights","DestructibleStreetlight","DestructibleSpacePlatformSign","DestructibleStoreFrontCityProps","DestructibleBillboardTall","DestructibleBillboardScrollingText","DestructibleSpacePlatformBarrier","DestructibleSignsDirectional","DestructibleSignsConstruction","DestructibleSignsFunny","DestructibleSignsIcons","DestructibleSignsWarning","DestructibleGarage","DestructibleGarageLarge","DestructibleTrafficSignal","TrafficSignal","BraxisAlphaDestructible1x1","BraxisAlphaDestructible2x2","DestructibleDebris4x4","DestructibleDebris6x6","DestructibleRock2x4Vertical","DestructibleRock2x4Horizontal","DestructibleRock2x6Vertical","DestructibleRock2x6Horizontal","DestructibleRock4x4","DestructibleRock6x6","DestructibleRampDiagonalHugeULBR","DestructibleRampDiagonalHugeBLUR","DestructibleRampVerticalHuge","DestructibleRampHorizontalHuge","DestructibleDebrisRampDiagonalHugeULBR","DestructibleDebrisRampDiagonalHugeBLUR","MengskStatueAlone","MengskStatue","WolfStatue","GlobeStatue","Weapon","GlaiveWurmBounceWeapon","BroodLordWeapon","BroodLordAWeapon","CreepBlocker1x1","PathingBlocker1x1","PathingBlocker2x2","AutoTestAttackTargetGround","AutoTestAttackTargetAir","AutoTestAttacker","HelperEmitterSelectionArrow","MultiKillObject","ShapeGolfball","ShapeCone","ShapeCube","ShapeCylinder","ShapeDodecahedron","ShapeIcosahedron","ShapeOctahedron","ShapePyramid","ShapeRoundedCube","ShapeSphere","ShapeTetrahedron","ShapeThickTorus","ShapeThinTorus","ShapeTorus","Shape4PointStar","Shape5PointStar","Shape6PointStar","Shape8PointStar","ShapeArrowPointer","ShapeBowl","ShapeBox","ShapeCapsule","ShapeCrescentMoon","ShapeDecahedron","ShapeDiamond","ShapeFootball","ShapeGemstone","ShapeHeart","ShapeJack","ShapePlusSign","ShapeShamrock","ShapeSpade","ShapeTube","ShapeEgg","ShapeYenSign","ShapeX","ShapeWatermelon","ShapeWonSign","ShapeTennisball","ShapeStrawberry","ShapeSmileyFace","ShapeSoccerball","ShapeRainbow","ShapeSadFace","ShapePoundSign","ShapePear","ShapePineapple","ShapeOrange","ShapePeanut","ShapeO","ShapeLemon","ShapeMoneyBag","ShapeHorseshoe","ShapeHockeyStick","ShapeHockeyPuck","ShapeHand","ShapeGolfClub","ShapeGrape","ShapeEuroSign","ShapeDollarSign","ShapeBasketball","ShapeCarrot","ShapeCherry","ShapeBaseball","ShapeBaseballBat","ShapeBanana","ShapeApple","ShapeCashLarge","ShapeCashMedium","ShapeCashSmall","ShapeFootballColored","ShapeLemonSmall","ShapeOrangeSmall","ShapeTreasureChestOpen","ShapeTreasureChestClosed","ShapeWatermelonSmall","MothershipCore","LocustMP","CollapsibleRockTowerDebris","HellionTank","NydusCanalAttacker","NydusCanalCreeper","SwarmHostBurrowedMP","SwarmHostMP","Oracle","Tempest","WarHound","WidowMine","Viper","WidowMineBurrowed","ExtendingBridgeNEWide8Out","ExtendingBridgeNEWide8","ExtendingBridgeNWWide8Out","ExtendingBridgeNWWide8","ExtendingBridgeNEWide10Out","ExtendingBridgeNEWide10","ExtendingBridgeNWWide10Out","ExtendingBridgeNWWide10","ExtendingBridgeNEWide12Out","ExtendingBridgeNEWide12","ExtendingBridgeNWWide12Out","ExtendingBridgeNWWide12","CollapsibleRockTowerPushUnit","CollapsibleTerranTowerPushUnit","CollapsibleTerranTowerDebris","DigesterCreepSprayTargetUnit","DigesterCreepSprayUnit","NydusCanalAttackerWeapon","ViperConsumeStructureWeapon","ResourceBlocker","TempestWeapon","YoinkMissile","WarHoundWeapon","EyeStalkWeapon","WidowMineWeapon","WidowMineAirWeapon","MothershipCoreWeaponWeapon","TornadoMissileWeapon","TornadoMissileDummyWeapon","TalonsMissileWeapon","CreepTumorMissile","LocustMPEggAMissileWeapon","LocustMPEggBMissileWeapon","LocustMPWeapon","ExtendingBridge","PhysicsPrimitiveParent","IceProtossCrates","ProtossCrates","TowerMine","PickupPalletGas","PickupPalletMinerals","PickupScrapSalvage1x1","PickupScrapSalvage2x2","PickupScrapSalvage3x3","RoughTerrain","UnbuildableBricksSmallUnit","UnbuildablePlatesSmallUnit","UnbuildablePlatesUnit","UnbuildableRocksSmallUnit","XelNagaHealingShrine","InvisibleTargetDummy","CollapsibleRockTowerDoubleWide","CollapsibleRockTower","CollapsibleRockTowerDiagonal","CollapsibleTerranTower","CollapsibleTerranTowerDiagonal","ZerglingFly","ThornLizard","CleaningBot","DestructibleRock6x6Weak","ProtossSnakeSegmentDemo","PhysicsPrimitives","PhysicsCube","PhysicsSphere","PhysicsCylinder","PhysicsCapsule","PhysicsStar","PhysicsKnot","PhysicsL","CreepBlocker4x4","DestructibleCityDebris2x4Vertical","DestructibleCityDebris2x4Horizontal","DestructibleCityDebris2x6Vertical","DestructibleCityDebris2x6Horizontal","DestructibleCityDebris4x4","DestructibleCityDebris6x6","DestructibleCityDebrisHugeDiagonalBLUR","DestructibleCityDebrisHugeDiagonalULBR","TestZerg","PathingBlockerRadius1","DestructibleRockEx12x4Vertical","DestructibleRockEx12x4Horizontal","DestructibleRockEx12x6Vertical","DestructibleRockEx12x6Horizontal","DestructibleRockEx14x4","DestructibleRockEx16x6","DestructibleRockEx1DiagonalHugeULBR","DestructibleRockEx1DiagonalHugeBLUR","DestructibleRockEx1VerticalHuge","DestructibleRockEx1HorizontalHuge","DestructibleIce2x4Vertical","DestructibleIce2x4Horizontal","DestructibleIce2x6Vertical","DestructibleIce2x6Horizontal","DestructibleIce4x4","DestructibleIce6x6","DestructibleIceDiagonalHugeULBR","DestructibleIceDiagonalHugeBLUR","DestructibleIceVerticalHuge","DestructibleIceHorizontalHuge","DesertPlanetSearchlight","DesertPlanetStreetlight","UnbuildableBricksUnit","UnbuildableRocksUnit","Artosilope","Anteplott","LabBot","Crabeetle","BeaconQQQ","BeaconArmy","LurkerMPEgg","LurkerMP","LurkerMPBurrowed","LurkerDenMP","CollapsibleRockTowerDebrisRampRight","CollapsibleRockTowerDebrisRampLeft","CollapsibleRockTowerPushUnitRampRight","CollapsibleRockTowerPushUnitRampLeft","YoinkVikingAirMissile","YoinkVikingGroundMissile","RepulsorCannonWeapon","ZerusDestructibleArch","CollapsibleRockTowerRampRight","CollapsibleRockTowerRampLeft","UnbuildableRocksDestructible","UnbuildableBricksDestructible","UnbuildablePlatesDestructible","DebrisRampLeft","DebrisRampRight","CollapsibleTerranTowerPushUnitRampLeft","CollapsibleTerranTowerPushUnitRampRight","CollapsibleTerranTowerRampLeft","CollapsibleTerranTowerRampRight","LabMineralField","ThorAALance","OracleWeapon","TempestWeaponGround","SeekerMissile","ProtossVespeneGeyser",
    ]

    statsCSV.writerow(statsHead)

    # Parse unit stats
    unitCount = [{"System_Snapshot_Dummy":0, "BeaconRally":0, "BeaconAttack":0, "BeaconDefend":0, "BeaconHarass":0, "BeaconIdle":0, "BeaconAuto":0, "BeaconDetect":0, "BeaconScout":0, "BeaconClaim":0, "BeaconExpand":0, "BeaconCustom1":0, "BeaconCustom2":0, "BeaconCustom3":0, "BeaconCustom4":0, "DESTRUCTIBLE":0, "ITEM":0, "POWERUP":0, "SMCAMERA":0, "SMCHARACTER":0, "STARMAP":0, "SMSET":0, "MISSILE":0, "MISSILE_INVULNERABLE":0, "MISSILE_HALFLIFE":0, "PLACEHOLDER":0, "PLACEHOLDER_AIR":0, "PATHINGBLOCKER":0, "BEACON":0, "Ball":0, "StereoscopicOptionsUnit":0, "Colossus":0, "TechLab":0, "Reactor":0, "InfestorTerran":0, "BanelingCocoon":0, "Baneling":0, "Mothership":0, "PointDefenseDrone":0, "Changeling":0, "ChangelingZealot":0, "ChangelingMarineShield":0, "ChangelingMarine":0, "ChangelingZerglingWings":0, "ChangelingZergling":0, "CommandCenter":0, "SupplyDepot":0, "Refinery":0, "Barracks":0, "EngineeringBay":0, "MissileTurret":0, "Bunker":0, "SensorTower":0, "GhostAcademy":0, "Factory":0, "Starport":0, "Armory":0, "FusionCore":0, "AutoTurret":0, "SiegeTankSieged":0, "SiegeTank":0, "VikingFighter":0, "VikingAssault":0, "CommandCenterFlying":0, "BarracksTechLab":0, "BarracksReactor":0, "FactoryTechLab":0, "FactoryReactor":0, "StarportTechLab":0, "StarportReactor":0, "FactoryFlying":0, "StarportFlying":0, "SCV":0, "BarracksFlying":0, "SupplyDepotLowered":0, "Marine":0, "Reaper":0, "Ghost":0, "Marauder":0, "Thor":0, "Hellion":0, "Medivac":0, "Banshee":0, "Raven":0, "Battlecruiser":0, "Nuke":0, "Nexus":0, "Pylon":0, "Assimilator":0, "Gateway":0, "Forge":0, "FleetBeacon":0, "TwilightCouncil":0, "PhotonCannon":0, "Stargate":0, "TemplarArchive":0, "DarkShrine":0, "RoboticsBay":0, "RoboticsFacility":0, "CyberneticsCore":0, "Zealot":0, "Stalker":0, "HighTemplar":0, "DarkTemplar":0, "Sentry":0, "Phoenix":0, "Carrier":0, "VoidRay":0, "WarpPrism":0, "Observer":0, "Immortal":0, "Probe":0, "Interceptor":0, "Hatchery":0, "CreepTumor":0, "Extractor":0, "SpawningPool":0, "EvolutionChamber":0, "HydraliskDen":0, "Spire":0, "UltraliskCavern":0, "InfestationPit":0, "NydusNetwork":0, "BanelingNest":0, "RoachWarren":0, "SpineCrawler":0, "SporeCrawler":0, "Lair":0, "Hive":0, "GreaterSpire":0, "Egg":0, "Drone":0, "Zergling":0, "Overlord":0, "Hydralisk":0, "Mutalisk":0, "Ultralisk":0, "Roach":0, "Infestor":0, "Corruptor":0, "BroodLordCocoon":0, "BroodLord":0, "BanelingBurrowed":0, "DroneBurrowed":0, "HydraliskBurrowed":0, "RoachBurrowed":0, "ZerglingBurrowed":0, "InfestorTerranBurrowed":0, "RedstoneLavaCritterBurrowed":0, "RedstoneLavaCritterInjuredBurrowed":0, "RedstoneLavaCritter":0, "RedstoneLavaCritterInjured":0, "QueenBurrowed":0, "Queen":0, "InfestorBurrowed":0, "OverlordCocoon":0, "Overseer":0, "PlanetaryFortress":0, "UltraliskBurrowed":0, "OrbitalCommand":0, "WarpGate":0, "OrbitalCommandFlying":0, "ForceField":0, "WarpPrismPhasing":0, "CreepTumorBurrowed":0, "CreepTumorQueen":0, "SpineCrawlerUprooted":0, "SporeCrawlerUprooted":0, "Archon":0, "NydusCanal":0, "BroodlingEscort":0, "RichMineralField":0, "XelNagaTower":0, "InfestedTerransEgg":0, "Larva":0, "ReaperPlaceholder":0, "NeedleSpinesWeapon":0, "CorruptionWeapon":0, "InfestedTerransWeapon":0, "NeuralParasiteWeapon":0, "PointDefenseDroneReleaseWeapon":0, "HunterSeekerWeapon":0, "MULE":0, "ThorAAWeapon":0, "PunisherGrenadesLMWeapon":0, "VikingFighterWeapon":0, "ATALaserBatteryLMWeapon":0, "ATSLaserBatteryLMWeapon":0, "LongboltMissileWeapon":0, "D8ChargeWeapon":0, "YamatoWeapon":0, "IonCannonsWeapon":0, "AcidSalivaWeapon":0, "SpineCrawlerWeapon":0, "SporeCrawlerWeapon":0, "GlaiveWurmWeapon":0, "GlaiveWurmM2Weapon":0, "GlaiveWurmM3Weapon":0, "StalkerWeapon":0, "EMP2Weapon":0, "BacklashRocketsLMWeapon":0, "PhotonCannonWeapon":0, "ParasiteSporeWeapon":0, "Broodling":0, "BroodLordBWeapon":0, "AutoTurretReleaseWeapon":0, "LarvaReleaseMissile":0, "AcidSpinesWeapon":0, "FrenzyWeapon":0, "ContaminateWeapon":0, "BroodlingDefault":0, "Critter":0, "CritterStationary":0, "Shape":0, "FungalGrowthMissile":0, "NeuralParasiteTentacleMissile":0, "Beacon_Protoss":0, "Beacon_ProtossSmall":0, "Beacon_Terran":0, "Beacon_TerranSmall":0, "Beacon_Zerg":0, "Beacon_ZergSmall":0, "Lyote":0, "CarrionBird":0, "KarakMale":0, "KarakFemale":0, "UrsadakMale":0, "UrsadakFemale":0, "UrsadakCalf":0, "UrsadakMaleExotic":0, "UrsadakFemaleExotic":0, "UtilityBot":0, "CommentatorBot1":0, "CommentatorBot2":0, "CommentatorBot3":0, "CommentatorBot4":0, "Scantipede":0, "Dog":0, "Sheep":0, "Cow":0, "InfestedTerransEggPlacement":0, "InfestorTerransWeapon":0, "MineralField":0, "VespeneGeyser":0, "SpacePlatformGeyser":0, "RichVespeneGeyser":0, "DestructibleSearchlight":0, "DestructibleBullhornLights":0, "DestructibleStreetlight":0, "DestructibleSpacePlatformSign":0, "DestructibleStoreFrontCityProps":0, "DestructibleBillboardTall":0, "DestructibleBillboardScrollingText":0, "DestructibleSpacePlatformBarrier":0, "DestructibleSignsDirectional":0, "DestructibleSignsConstruction":0, "DestructibleSignsFunny":0, "DestructibleSignsIcons":0, "DestructibleSignsWarning":0, "DestructibleGarage":0, "DestructibleGarageLarge":0, "DestructibleTrafficSignal":0, "TrafficSignal":0, "BraxisAlphaDestructible1x1":0, "BraxisAlphaDestructible2x2":0, "DestructibleDebris4x4":0, "DestructibleDebris6x6":0, "DestructibleRock2x4Vertical":0, "DestructibleRock2x4Horizontal":0, "DestructibleRock2x6Vertical":0, "DestructibleRock2x6Horizontal":0, "DestructibleRock4x4":0, "DestructibleRock6x6":0, "DestructibleRampDiagonalHugeULBR":0, "DestructibleRampDiagonalHugeBLUR":0, "DestructibleRampVerticalHuge":0, "DestructibleRampHorizontalHuge":0, "DestructibleDebrisRampDiagonalHugeULBR":0, "DestructibleDebrisRampDiagonalHugeBLUR":0, "MengskStatueAlone":0, "MengskStatue":0, "WolfStatue":0, "GlobeStatue":0, "Weapon":0, "GlaiveWurmBounceWeapon":0, "BroodLordWeapon":0, "BroodLordAWeapon":0, "CreepBlocker1x1":0, "PathingBlocker1x1":0, "PathingBlocker2x2":0, "AutoTestAttackTargetGround":0, "AutoTestAttackTargetAir":0, "AutoTestAttacker":0, "HelperEmitterSelectionArrow":0, "MultiKillObject":0, "ShapeGolfball":0, "ShapeCone":0, "ShapeCube":0, "ShapeCylinder":0, "ShapeDodecahedron":0, "ShapeIcosahedron":0, "ShapeOctahedron":0, "ShapePyramid":0, "ShapeRoundedCube":0, "ShapeSphere":0, "ShapeTetrahedron":0, "ShapeThickTorus":0, "ShapeThinTorus":0, "ShapeTorus":0, "Shape4PointStar":0, "Shape5PointStar":0, "Shape6PointStar":0, "Shape8PointStar":0, "ShapeArrowPointer":0, "ShapeBowl":0, "ShapeBox":0, "ShapeCapsule":0, "ShapeCrescentMoon":0, "ShapeDecahedron":0, "ShapeDiamond":0, "ShapeFootball":0, "ShapeGemstone":0, "ShapeHeart":0, "ShapeJack":0, "ShapePlusSign":0, "ShapeShamrock":0, "ShapeSpade":0, "ShapeTube":0, "ShapeEgg":0, "ShapeYenSign":0, "ShapeX":0, "ShapeWatermelon":0, "ShapeWonSign":0, "ShapeTennisball":0, "ShapeStrawberry":0, "ShapeSmileyFace":0, "ShapeSoccerball":0, "ShapeRainbow":0, "ShapeSadFace":0, "ShapePoundSign":0, "ShapePear":0, "ShapePineapple":0, "ShapeOrange":0, "ShapePeanut":0, "ShapeO":0, "ShapeLemon":0, "ShapeMoneyBag":0, "ShapeHorseshoe":0, "ShapeHockeyStick":0, "ShapeHockeyPuck":0, "ShapeHand":0, "ShapeGolfClub":0, "ShapeGrape":0, "ShapeEuroSign":0, "ShapeDollarSign":0, "ShapeBasketball":0, "ShapeCarrot":0, "ShapeCherry":0, "ShapeBaseball":0, "ShapeBaseballBat":0, "ShapeBanana":0, "ShapeApple":0, "ShapeCashLarge":0, "ShapeCashMedium":0, "ShapeCashSmall":0, "ShapeFootballColored":0, "ShapeLemonSmall":0, "ShapeOrangeSmall":0, "ShapeTreasureChestOpen":0, "ShapeTreasureChestClosed":0, "ShapeWatermelonSmall":0, "MothershipCore":0, "LocustMP":0, "CollapsibleRockTowerDebris":0, "HellionTank":0, "NydusCanalAttacker":0, "NydusCanalCreeper":0, "SwarmHostBurrowedMP":0, "SwarmHostMP":0, "Oracle":0, "Tempest":0, "WarHound":0, "WidowMine":0, "Viper":0, "WidowMineBurrowed":0, "ExtendingBridgeNEWide8Out":0, "ExtendingBridgeNEWide8":0, "ExtendingBridgeNWWide8Out":0, "ExtendingBridgeNWWide8":0, "ExtendingBridgeNEWide10Out":0, "ExtendingBridgeNEWide10":0, "ExtendingBridgeNWWide10Out":0, "ExtendingBridgeNWWide10":0, "ExtendingBridgeNEWide12Out":0, "ExtendingBridgeNEWide12":0, "ExtendingBridgeNWWide12Out":0, "ExtendingBridgeNWWide12":0, "CollapsibleRockTowerPushUnit":0, "CollapsibleTerranTowerPushUnit":0, "CollapsibleTerranTowerDebris":0, "DigesterCreepSprayTargetUnit":0, "DigesterCreepSprayUnit":0, "NydusCanalAttackerWeapon":0, "ViperConsumeStructureWeapon":0, "ResourceBlocker":0, "TempestWeapon":0, "YoinkMissile":0, "WarHoundWeapon":0, "EyeStalkWeapon":0, "WidowMineWeapon":0, "WidowMineAirWeapon":0, "MothershipCoreWeaponWeapon":0, "TornadoMissileWeapon":0, "TornadoMissileDummyWeapon":0, "TalonsMissileWeapon":0, "CreepTumorMissile":0, "LocustMPEggAMissileWeapon":0, "LocustMPEggBMissileWeapon":0, "LocustMPWeapon":0, "ExtendingBridge":0, "PhysicsPrimitiveParent":0, "IceProtossCrates":0, "ProtossCrates":0, "TowerMine":0, "PickupPalletGas":0, "PickupPalletMinerals":0, "PickupScrapSalvage1x1":0, "PickupScrapSalvage2x2":0, "PickupScrapSalvage3x3":0, "RoughTerrain":0, "UnbuildableBricksSmallUnit":0, "UnbuildablePlatesSmallUnit":0, "UnbuildablePlatesUnit":0, "UnbuildableRocksSmallUnit":0, "XelNagaHealingShrine":0, "InvisibleTargetDummy":0, "CollapsibleRockTowerDoubleWide":0, "CollapsibleRockTower":0, "CollapsibleRockTowerDiagonal":0, "CollapsibleTerranTower":0, "CollapsibleTerranTowerDiagonal":0, "ZerglingFly":0, "ThornLizard":0, "CleaningBot":0, "DestructibleRock6x6Weak":0, "ProtossSnakeSegmentDemo":0, "PhysicsPrimitives":0, "PhysicsCube":0, "PhysicsSphere":0, "PhysicsCylinder":0, "PhysicsCapsule":0, "PhysicsStar":0, "PhysicsKnot":0, "PhysicsL":0, "CreepBlocker4x4":0, "DestructibleCityDebris2x4Vertical":0, "DestructibleCityDebris2x4Horizontal":0, "DestructibleCityDebris2x6Vertical":0, "DestructibleCityDebris2x6Horizontal":0, "DestructibleCityDebris4x4":0, "DestructibleCityDebris6x6":0, "DestructibleCityDebrisHugeDiagonalBLUR":0, "DestructibleCityDebrisHugeDiagonalULBR":0, "TestZerg":0, "PathingBlockerRadius1":0, "DestructibleRockEx12x4Vertical":0, "DestructibleRockEx12x4Horizontal":0, "DestructibleRockEx12x6Vertical":0, "DestructibleRockEx12x6Horizontal":0, "DestructibleRockEx14x4":0, "DestructibleRockEx16x6":0, "DestructibleRockEx1DiagonalHugeULBR":0, "DestructibleRockEx1DiagonalHugeBLUR":0, "DestructibleRockEx1VerticalHuge":0, "DestructibleRockEx1HorizontalHuge":0, "DestructibleIce2x4Vertical":0, "DestructibleIce2x4Horizontal":0, "DestructibleIce2x6Vertical":0, "DestructibleIce2x6Horizontal":0, "DestructibleIce4x4":0, "DestructibleIce6x6":0, "DestructibleIceDiagonalHugeULBR":0, "DestructibleIceDiagonalHugeBLUR":0, "DestructibleIceVerticalHuge":0, "DestructibleIceHorizontalHuge":0, "DesertPlanetSearchlight":0, "DesertPlanetStreetlight":0, "UnbuildableBricksUnit":0, "UnbuildableRocksUnit":0, "Artosilope":0, "Anteplott":0, "LabBot":0, "Crabeetle":0, "BeaconQQQ":0, "BeaconArmy":0, "LurkerMPEgg":0, "LurkerMP":0, "LurkerMPBurrowed":0, "LurkerDenMP":0, "CollapsibleRockTowerDebrisRampRight":0, "CollapsibleRockTowerDebrisRampLeft":0, "CollapsibleRockTowerPushUnitRampRight":0, "CollapsibleRockTowerPushUnitRampLeft":0, "YoinkVikingAirMissile":0, "YoinkVikingGroundMissile":0, "RepulsorCannonWeapon":0, "ZerusDestructibleArch":0, "CollapsibleRockTowerRampRight":0, "CollapsibleRockTowerRampLeft":0, "UnbuildableRocksDestructible":0, "UnbuildableBricksDestructible":0, "UnbuildablePlatesDestructible":0, "DebrisRampLeft":0, "DebrisRampRight":0, "CollapsibleTerranTowerPushUnitRampLeft":0, "CollapsibleTerranTowerPushUnitRampRight":0, "CollapsibleTerranTowerRampLeft":0, "CollapsibleTerranTowerRampRight":0, "LabMineralField":0, "ThorAALance":0, "OracleWeapon":0, "TempestWeaponGround":0, "SeekerMissile":0, "ProtossVespeneGeyser":0}] * 3

    for event in replay.tracker_events:
        if (event.name == 'UnitBornEvent' or event.name == 'UnitDoneEvent' or event.name == 'UnitDiedEvent') and event.unit.owner and event.unit.name in unitCount[event.unit.owner.pid]:
            unitCount[event.unit.owner.pid][event.unit.name] += -1 if event.name == 'UnitDiedEvent' else 1
        elif event.name == 'UnitTypeChangeEvent' and event.unit.owner and event.unit_type_name in unitCount[event.unit.owner.pid]:
            unitCount[event.unit.owner.pid][event.unit_type_name] += 1
        else:
            continue
        if event.unit.owner:
            statsCSV.writerow([1 if event.unit.owner.pid == winner else 0, event.second] + list(unitCount[event.unit.owner.pid].values()))

    statsFile.close()

    #update progress bar
    pbar.update(num)

pbar.close()